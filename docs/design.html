<!DOCTYPE HTML>
<!--
    Escape Velocity by HTML5 UP
    html5up.net | @ajlkn
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
    <head>
        <title>Overbuilt and Underpaid</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
        <link rel="stylesheet" href="assets/css/main.css" />
        <!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
    </head>
    <body class="homepage">
        <div id="page-wrapper">

            <!-- Header -->
                <div id="header-wrapper" class="wrapper">
                    <div id="header">

                        <!-- Logo -->
                            <div id="logo">
                                <h1><a href="index.html">Robot Design</a></h1>
                                <p>ECE 3400 Team 2 Fall 2017</p>
                            </div>

                        <!-- Nav -->
                            <nav id="nav">
                                <ul>
                                    <li class="current"><a href="index.html">Home</a></li>
                                    <li>
                                        <a href="#">Labs</a>
                                        <ul>
                                            <li><a href="lab1.html">Lab 1</a></li>
                                            <li><a href="lab2.html">Lab 2</a></li>
                                            <li><a href="lab3.html">Lab 3</a></li>
                                            <li><a href="lab4.html">Lab 4</a></li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="#">Milestones</a>
                                        <ul>
                                            <li><a href="milestone1.html">Milestone 1</a></li>
                                            <li><a href="milestone2.html">Milestone 2</a></li>
                                            <li><a href="milestone3.html">Milestone 3</a></li>
                                            <li><a href="milestone4.html">Milestone 4</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="info.html">Team Info</a></li>
                                    <li><a href="minutes.html">Meeting Minutes</a></li>
                                    <li>
                                        <a href="#">Robot Design & Cost</a>
                                        <ul>
                                            <li><a href="design.html">Robot Design</a></li>
                                            <li><a href="cost.html">Robot Cost</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="ethics.html">Ethics</a></li>
                                </ul>
                            </nav>
                    
                    </div>
                </div>
                
                <div id="intro-wrapper" class="wrapper style1">
                    <div class="title">Movement</div>
                    <section id="intro" class="container">
                        <p>
                            Text here
                            
                        </p>
                        
                        
                        <p>
                        <center>
                            <iframe width="560" height="315" src="https://www.youtube.com/embed/1ABYLtSU5fY" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>
                        </center>
                       </p>
                        
                       
                    </section>
                </div>
                
                <div id="intro-wrapper" class="wrapper style2">
                    <div class="title">FPGA</div>
                    <section id="intro" class="container">
                        <header class="style1">
                            <h2>Confronting Our Problems</h2>
                        </header>
                        <p>
                            Following Milestone 4, we encountered several issues regarding our FPGA code resulting in random pixelation and incorrect locations
                            being colored in. We were able to initialize and color the starting maze correctly, but when we coded the Arduino to send hard-coded
                            instruction values via SPI the problems surfaced. Our grid was colored by having an always (*) block with combinational logic to assign
                            each small pixel segment to a color. Since our grid was being randomly colored we figured that these statements were being called out of order
                            within the body of our code. To correct this issue, we decided to implement a state machine with 8 states to help debugging with an emphasis on
                            individually separating different pixel locations where we would color. This is the reason why Treasure and Current Location coloring share the same
                            state, and each wall is split up into a new state. Below indicates the states we chose to divide our FPGA's function into independent sections:
                            <center>
                                    <ul>
                                        <li>State 000 = Initialize/ Reset</li>
                                        <li>State 001 = Parse Incoming Data</li>
                                        <li>State 010 = Treasure and Current Location Color</li>
                                        <li>State 011 = West Wall Color</li>
                                        <li>State 100 = East Wall Color</li>
                                        <li>State 101 = South Wall Color</li>
                                        <li>State 110 = North Wall Color</li>
                                        <li>State 111 = Done and Audio</li>
                                    </ul>
                                </center>
                        </p>
                        
                        <p>
                            We followed the same grid mapping scheme in Milestone 4 by dividing the entire screen into 10x10 pixel grids with our maze being spanned by 36x45 of these pixel grids
                            for a total area of 360x450 pixels. The actual maze represented by a 4x5 grid would be treated as a 9x11 grid by our FPGA to account for all of the walls in addition to
                            all possible grid spaces. As the final competition neared, we realized the colors we chose to initially color the maze for Milestone 4 utilized Red, Green, and Blue to represent other
                            features of the maze instead of Treasures. Below is a list of the updated color scheme for our maze:
                            <center>
                                    <ul>
                                        <li>Turqoise = Unvisited/unreachable grid space</li>
                                        <li>Yellow = Robot's current position</li>
                                        <li>Purple = Already visited grid space</li>
                                        <li>White = No wall</li>
                                        <li>Black = Wall</li>
                                        <li>Red = 7 kHz treasure at that grid space</li>
                                        <li>Green = 12 kHz treasure at that grid space</li>
                                        <li>Blue = 17 kHz treasure at that grid space</li>
                                    </ul>
                                </center>
                        </p>
                        
                        <header class="style1">
                            <h2>State 000: Initialize/ Reset</h2>
                        </header>
                        
                        <p>
                        To incorporate a state machine effectively, we wanted to have our robot functions synced with the FPGA clock to avoid the possibility of floating values,
                        which likely could have been the reason for the pixelation we were experiencing. State 000 is when we reset of initialize the maze, so we use nested for loops
                        to cycle through every grid position in our entire 36x45 maze to color all node location turqoise for unvisited, the perimeter walls black to indicate the boundaries of the maze,
                        and all interior walls white since we are unsure if there is a wall there or not. We also initialize our xy- position to be at the bottom right of the maze because this is
                        a precondition of the competition. Our last position is then updated to have the xy- position value in binary to represent starting at the bottom right in our data representation scheme
                        before moving onto State 001. 
                        </p>
                        
                         <pre><code class="cpp">
                        always @ (posedge CLOCK_25) begin       // Set always block to posedge CLK 
                            if (reset) begin    // Condition for State 000
		
                            integer i;
                            integer j;
                
                            for (i = 0; i < 37; i=i+1) begin    // Loop through pixel grid
                                for (j = 0; j < 46; j=j+1) begin 
                                
                                    wall_grid[i][j] = 3'b000;   // Color all unvisited turqoise
                                    
                                    if (i%9 == 0) begin         // Color all walls white to start
                                        wall_grid[i][j] = 3'b011; 
                                    end
                                        
                                    if (j%9 == 0) begin         // Color all walls white to start
                                        wall_grid[i][j] = 3'b011;
                                    end
                                    if (i%36 == 0) begin        // Color perimeter walls black
                                        wall_grid[i][j] = 3'b100;
                                    end
                                    if (j%45 == 0) begin        // Color perimeter walls black
                                        wall_grid[i][j] = 3'b100;
                                    end
                                    else begin                  // Close inferred latches
                                        wall_grid[i][j] = wall_grid[i][j];
                                    end
                                end
                            end
                            
                            xpos = 3;                           // Initialize starting at bottom right
                            ypos = 4;
                            state = 3'b001;                     // Next state
                            check = 1'b0;
                            LAST_POS = 16'bxxx10011xxxxxxxx;    // Save last position at bottom right
                            doneaudio = 1'b0;                   // Initialize low to not play audio tone
                        end
                        </code></pre><br />
                        
                        <header class="style1">
                            <h2>State 001: Parse Incoming Data</h2>
                        </header>
                        
                        <p>
                        In this state, we first check if DONE is set to HIGH which would indicate the data is ready to be read from the SPI transfer. The actual data is stored in a 16
                        bit long register titled DOUT. We parse the 16 bits accordingly to the code below.
                        </p>
                        
                        <pre><code class="cpp">
                        else if (DONE == 1'b1 && state == 3'b001) begin
                            CURR_POS = DOUT;                            // Save data
                            donecheck = (CURR_POS[15:13]);              // Signals when robot is done
                            ypos = (CURR_POS[12:10]);
                            xpos = (CURR_POS[9:8]);
                            treasure = CURR_POS[7:6];
                            visited = CURR_POS[5];
                            unreach = CURR_POS[4];
                            wallw = CURR_POS[3];
                            walle = CURR_POS[2];
                            walls = CURR_POS[1];
                            walln = CURR_POS[0];
                            state = 3'b010;                             // Next State
                            
                        end
                        </code></pre><br />
                        
                        <header class="style1">
                            <h2>State 010 = Treasure and Current Location</h2>
                        </header>
                        
                        <p>
                            
                        </p>
                        
                        
                        
                        
                        
                       <p>
                        <center>
                            <iframe width="560" height="315" src="https://www.youtube.com/embed/urRlNmFFwDs" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>
                        </center>
                       </p>
                       
                       
                    </section>
                </div>
                
                <div id="intro-wrapper" class="wrapper style3">
                    <div class="title">Radio Transmission</div>
                    <section id="intro" class="container">
                        <p>
                            Text here
                        </p>
                        
                       
                    </section>
                </div>
                
                <div id="intro-wrapper" class="wrapper style1">
                    <div class="title">Final Competition</div>
                    <section id="intro" class="container">
                        <p>
                            Text here
                        </p>
                        
                       
                    </section>
                </div>
        
        </div>
        
        <!-- Scripts -->

            <script src="assets/js/jquery.min.js"></script>
            <script src="assets/js/jquery.dropotron.min.js"></script>
            <script src="assets/js/skel.min.js"></script>
            <script src="assets/js/skel-viewport.min.js"></script>
            <script src="assets/js/util.js"></script>
            <!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
            <script src="assets/js/main.js"></script>

    </body>
</html>